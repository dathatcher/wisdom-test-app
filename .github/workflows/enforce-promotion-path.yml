name: Enforce promotion path

on:
  pull_request:
    types: [opened, reopened, synchronize, ready_for_review]

jobs:
  enforce:
    name: Promotion Guardrail
    runs-on: ubuntu-latest
    steps:
      - name: Enforce allowed PR sources
        shell: bash
        run: |
          base="${{ github.base_ref }}"
          head="${{ github.head_ref }}"
          actor="${{ github.actor }}"
          pr="${{ github.event.pull_request.number }}"

          echo "Head*(Source) branch: $head"
          echo "Base(Target) branch: $base"          
          echo "Actor: $actor"
          echo "PR: $pr"

          fail() { echo "ERROR: $1 - $actor"; exit 1; }

          # Rule 1: quantico must come from development
          if [[ "$base" == "quantico" ]]; then
            [[ "$head" == "development" ]] || fail "PRs into 'quantico' must come from 'development' (got '$head')."
          fi

          # Rule 2: catweb must come from quantico
          if [[ "$base" == "catweb" ]]; then
            [[ "$head" == "quantico" ]] || fail "PRs into 'catweb' must come from 'quantico' (got '$head')."
          fi
          echo "OK: Promotion path validated."
